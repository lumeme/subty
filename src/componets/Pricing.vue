<template>
    <div class="col-12 col-md-9 d-flex flex-column justify-content-start align-items-center section contact pb-lg-5">
        <div class="row justify-content-center w-100 mt-5">
            <div class="col-12 d-flex flex-column justify-content-center align-items-start px-0 pb-4">
                <p class="yellow">{{ $t('message.sendUSAMessage') }}</p>
                <h2>{{ $t('message.pricing') }}</h2>
            </div>
        </div>
        <div class="row justify-content-between w-100 pt-4 pb-3">
            <div class="col-12 col-lg d-flex justify-content-center align-items-center pe-0 container-card px-0 mx-0 pricing">
                <div class="row justify-content-center h-100 w-100 card-grey">
                    <div class="col-12 d-flex justify-content-center align-items-center px-0">
                        <div class="row justify-content-center w-100">
                            <div class="col-12 d-flex flex-column justify-content-center align-items-start info">
                                <div class="d-flex justify-content-start align-items-center w-100">
                                    <h3>Basic</h3>
                                </div>
                                <p>100 minutes of video, 1 language</p>
                            </div>
                            <div class="col-12 d-flex flex-column justify-content-center align-items-start info">
                                <div class="d-flex justify-content-start align-items-center w-100">
                                    <h3>$1</h3>
                                    <p>USD/min. Sub</p>
                                </div>
                                <p>$100 USD/month</p>
                            </div>
                            <div class="col-12 d-flex justify-content-center align-items-center px-0">
                                <button>
                                    Contact
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 d-flex justify-content-center align-items-center px-0">
                        <div class="row justify-content-center w-100">
                            <div class="col-12 d-flex justify-content-start align-items-center info">
                                <img src="../../img/pricing-icons/check.svg" alt="" class="check">
                                <p>$100 USD/month</p>
                            </div>
                            <div class="col-12 d-flex justify-content-start align-items-center info">
                                <img src="../../img/pricing-icons/check.svg" alt="" class="check">
                                <p>$100 USD/month</p>
                            </div>
                            <div class="col-12 d-flex justify-content-start align-items-center info">
                                <img src="../../img/pricing-icons/check.svg" alt="" class="check">
                                <p>$100 USD/month</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg mx-4 d-flex justify-content-center align-items-center pe-0 container-card px-0 mx-0 pricing">
                <div class="row justify-content-center h-100 w-100 card-grey">
                    <div class="col-12 d-flex justify-content-center align-items-center px-0">
                        <div class="row justify-content-center w-100">
                            <div class="col-12 d-flex flex-column justify-content-center align-items-start info">
                                <div class="d-flex justify-content-start align-items-center w-100">
                                    <h3>Basic</h3>
                                </div>
                                <p>100 minutes of video, 1 language</p>
                            </div>
                            <div class="col-12 d-flex flex-column justify-content-center align-items-start info">
                                <div class="d-flex justify-content-start align-items-center w-100">
                                    <h3>$1</h3>
                                    <p>USD/min. Sub</p>
                                </div>
                                <p>$100 USD/month</p>
                            </div>
                            <div class="col-12 d-flex justify-content-center align-items-center px-0">
                                <button>
                                    Contact
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 d-flex justify-content-center align-items-center px-0">
                        <div class="row justify-content-center w-100">
                            <div class="col-12 d-flex justify-content-start align-items-center info">
                                <img src="../../img/pricing-icons/check.svg" alt="" class="check">
                                <p>$100 USD/month</p>
                            </div>
                            <div class="col-12 d-flex justify-content-start align-items-center info">
                                <img src="../../img/pricing-icons/check.svg" alt="" class="check">
                                <p>$100 USD/month</p>
                            </div>
                            <div class="col-12 d-flex justify-content-start align-items-center info">
                                <img src="../../img/pricing-icons/check.svg" alt="" class="check">
                                <p>$100 USD/month</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg d-flex justify-content-center align-items-center pe-0 container-card px-0 mx-0 pricing">
                <div class="row justify-content-center h-100 w-100 card-grey">
                    <div class="col-12 d-flex justify-content-center align-items-center px-0">
                        <div class="row justify-content-center w-100">
                            <div class="col-12 d-flex flex-column justify-content-center align-items-start info">
                                <div class="d-flex justify-content-start align-items-center w-100">
                                    <h3>Basic</h3>
                                </div>
                                <p>100 minutes of video, 1 language</p>
                            </div>
                            <div class="col-12 d-flex flex-column justify-content-center align-items-start info">
                                <div class="d-flex justify-content-start align-items-center w-100">
                                    <h3>$1</h3>
                                    <p>USD/min. Sub</p>
                                </div>
                                <p>$100 USD/month</p>
                            </div>
                            <div class="col-12 d-flex justify-content-center align-items-center px-0">
                                <button>
                                    Contact
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 d-flex justify-content-center align-items-center px-0">
                        <div class="row justify-content-center w-100">
                            <div class="col-12 d-flex justify-content-start align-items-center info">
                                <img src="../../img/pricing-icons/check.svg" alt="" class="check">
                                <p>$100 USD/month</p>
                            </div>
                            <div class="col-12 d-flex justify-content-start align-items-center info">
                                <img src="../../img/pricing-icons/check.svg" alt="" class="check">
                                <p>$100 USD/month</p>
                            </div>
                            <div class="col-12 d-flex justify-content-start align-items-center info">
                                <img src="../../img/pricing-icons/check.svg" alt="" class="check">
                                <p>$100 USD/month</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<script setup>
import MazPhoneNumberInput from 'maz-ui/components/MazPhoneNumberInput.mjs'
import { useGeneralStore } from "@/stores/general";
import { storeToRefs } from "pinia";
import { createI18n, useI18n } from "vue-i18n";
import { ref } from 'vue';
import Swal from 'sweetalert2'


const general = useGeneralStore();
const {} = storeToRefs(general);
const {url} = general
const { t } = useI18n({ useScope: 'global' })

const contact = ref({
    name: '',
    email: '',
    message: ''
})

const results = ref({
    formatInternational: ""
})
const phone = ref()

const disabled = ref(false)

function sendMail() {
    console.log(disabled.value, 'comienzo')
    disabled.value = true
    const name = contact.value.name;
    const email = contact.value.email;
    const phone = results.value.formatInternational;
    const message = contact.value.message;
    const validateEmailConst = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;   
    const validatePhoneConst = /^\+?[\d\s-]+$/;
    // Validación para verificar si alguno de los campos está vacío
    const validateName = () => {
        if (!name ) {
            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            })
            Toast.fire({
                icon: 'error',
                title: t('message.errorName')
            })
            //console.log('false')
            return false
        }else{
            return true
        }
    }
    const validateEmail = () => {
        if (!email) {
            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            })
            Toast.fire({
                icon: 'error',
                title: t('message.errorEmail')
            })
            //console.log('false email')
            return false
        }else if (validateEmailConst.test(email) == false){
            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            })
            Toast.fire({
                icon: 'error',
                title: t('message.errorEmail2')
            })
            //console.log('false email')
            return false
        }
        else{
            return true
        }
    }
    const validatePhone = () => {
        if (!phone) {
            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            })
            Toast.fire({
                icon: 'error',
                title: t('message.errorPhone')
            })
            return false
        }else if (validatePhoneConst.test(phone) == false){
            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            })
            Toast.fire({
                icon: 'error',
                title: t('message.errorPhone2')
            })
            return false
        }
        else{
            return true
        }
    }
    const validateMessage = () => {
        if (!message ) {
            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            })
            Toast.fire({
                icon: 'error',
                title: t('message.errorMessage')
            })
            return false
        }else{
            return true
        }
    }
    if (validateName() === true && validateEmail() == true && validatePhone() == true && validateMessage() == true) {
        fetch(url+'/api/send_mail.php', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                name: name,
                email: email,
                phone: phone,
                message: message
            })
        })
        .then(response => response.text())
        .then(data => {
            let dataParse = JSON.parse(data)
            //console.log(JSON.parse(data));
            //console.log(dataParse.inf.result)
            // Aquí puedes agregar la condición para verificar si la respuesta es correcta o no
            if (dataParse.inf.result == true) {
                //console.log('holi')
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })
                Toast.fire({
                    icon: 'success',
                    title: t('message.success')
                })
            } else {
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })
                Toast.fire({
                    icon: 'error',
                    title: t('message.error2')
                })
            }
        })    
        disabled.value = false
        return
    }else{
        disabled.value = false
        //console.log(phone)
    }
    disabled.value = false
}
// let button = document.getElementsByClassName('m-select-input__toggle-button')
// setInterval(function(){
    
//     button[0].dispatchEvent(new Event('click'))
// }, 1)
</script>

<style lang="scss" scoped>

</style>